# üêõ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –º–æ–¥—É–ª—è Auth

## üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏

### 36. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null company –≤ jwt.strategy.ts**
**–§–∞–π–ª:** `server/src/auth/strategies/jwt.strategy.ts` (—Å—Ç—Ä–æ–∫–∞ 71-73)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –∫–æ–º–ø–∞–Ω–∏—è –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞, `user.company` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `!user || user.status !== 'ACTIVE'`, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `user.company`
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–µ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ `user.company.id` –∏–ª–∏ `user.company.name` –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
if (!user || user.status !== 'ACTIVE') {
  throw new UnauthorizedException();
}

if (payload.companyId && user.companyId !== payload.companyId) {
  // ...
}

return user; // user.company –º–æ–∂–µ—Ç –±—ã—Ç—å null!
```

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ null company:
```typescript
if (!user || user.status !== 'ACTIVE') {
  throw new UnauthorizedException();
}

// Check if company exists
if (!user.company) {
  this.logger.warn(
    {
      userId: user.id,
      companyId: user.companyId,
    },
    'User has no associated company',
  );
  throw new UnauthorizedException('User company not found');
}

if (payload.companyId && user.companyId !== payload.companyId) {
  // ...
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π (–º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å runtime error)

---

### 37. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null companyId –≤ payload**
**–§–∞–π–ª:** `server/src/auth/strategies/jwt.strategy.ts` (—Å—Ç—Ä–æ–∫–∞ 75)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ `payload.companyId` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø–æ–∑–≤–æ–ª–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –±–µ–∑ companyId, —á—Ç–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
if (payload.companyId && user.companyId !== payload.companyId) {
  // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ payload.companyId —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
}
```

**–†–µ—à–µ–Ω–∏–µ:**
–¢—Ä–µ–±–æ–≤–∞—Ç—å companyId –≤ payload:
```typescript
if (!payload.companyId) {
  this.logger.warn(
    {
      userId: user.id,
      payloadSub: payload.sub,
    },
    'Token missing companyId',
  );
  throw new UnauthorizedException('Token is invalid - missing companyId');
}

if (user.companyId !== payload.companyId) {
  // ...
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –±–µ–∑ companyId)

---

## üü° –°—Ä–µ–¥–Ω–∏–µ –±–∞–≥–∏

### 38. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ avatar URL**
**–§–∞–π–ª:** `server/src/auth/dto/register.dto.ts` (—Å—Ç—Ä–æ–∫–∞ 33), `server/src/auth/auth.service.ts` (—Å—Ç—Ä–æ–∫–∞ 111)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `avatar` –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–π —Å—Ç—Ä–æ–∫–æ–π, –≤–∫–ª—é—á–∞—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ URL –∏–ª–∏ –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å URL —Ñ–æ—Ä–º–∞—Ç–∞
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
@IsOptional()
@IsString()
avatar?: string;
```

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é URL –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É:
```typescript
@IsOptional()
@IsString()
@IsUrl({ require_protocol: true, protocols: ['http', 'https'] })
@MaxLength(2048, { message: 'Avatar URL must not exceed 2048 characters' })
avatar?: string;
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π XSS –∏–ª–∏ DoS)

---

### 39. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã companyDomain**
**–§–∞–π–ª:** `server/src/auth/dto/register.dto.ts` (—Å—Ç—Ä–æ–∫–∞ 26), `server/src/auth/auth.service.ts` (—Å—Ç—Ä–æ–∫–∞ 58-65)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `companyDomain` –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–º, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É –≤ DTO

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
@IsOptional()
@IsString()
companyDomain?: string;
```

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã:
```typescript
@IsOptional()
@IsString()
@MaxLength(255, { message: 'Company domain must not exceed 255 characters' })
companyDomain?: string;
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)

---

### 40. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ user –≤ getProfile**
**–§–∞–π–ª:** `server/src/auth/auth.controller.ts` (—Å—Ç—Ä–æ–∫–∞ 27)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `any` –≤–º–µ—Å—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞
- –ù–µ—Ç type safety

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
async getProfile(@GetUser() user: any) {
  return user;
}
```

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø:
```typescript
import { User } from '@prisma/client';

async getProfile(@GetUser() user: User) {
  return user;
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π (type safety)

---

### 41. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å UUID –≤ payload.sub**
**–§–∞–π–ª:** `server/src/auth/strategies/jwt.strategy.ts` (—Å—Ç—Ä–æ–∫–∞ 51-52)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `payload.sub` –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º UUID
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–µ –≤ `findUnique` –∏–ª–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
const user = await this.prisma.user.findUnique({
  where: { id: payload.sub },
  // ...
});
```

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å UUID:
```typescript
// Validate UUID format
const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
if (!uuidRegex.test(payload.sub)) {
  throw new UnauthorizedException('Invalid token payload - invalid user ID format');
}

const user = await this.prisma.user.findUnique({
  where: { id: payload.sub },
  // ...
});
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)

---

### 42. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å UUID –≤ validateUser**
**–§–∞–π–ª:** `server/src/auth/auth.service.ts` (—Å—Ç—Ä–æ–∫–∞ 224-229)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `userId` –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º UUID
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–µ –≤ `findUnique`

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
async validateUser(userId: string) {
  if (!userId) {
    return null;
  }

  const user = await this.prisma.user.findUnique({
    where: { id: userId },
    // ...
  });
}
```

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å UUID:
```typescript
async validateUser(userId: string) {
  if (!userId) {
    return null;
  }

  // Validate UUID format
  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
  if (!uuidRegex.test(userId)) {
    this.logger.warn(
      {
        userId,
      },
      'Invalid user ID format in validateUser',
    );
    return null;
  }

  const user = await this.prisma.user.findUnique({
    where: { id: userId },
    // ...
  });
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)

---

### 43. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å email —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏**
**–§–∞–π–ª:** `server/src/auth/auth.service.ts` (—Å—Ç—Ä–æ–∫–∞ 21, 145)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ email –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º (—Ö–æ—Ç—è –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ)
- DTO —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –≤ —Å–µ—Ä–≤–∏—Å–µ

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, DTO —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç).

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)

---

## üü¢ –ù–∏–∑–∫–∏–µ –±–∞–≥–∏ / –£–ª—É—á—à–µ–Ω–∏—è

### 44. **–£–ª—É—á—à–µ–Ω–∏–µ RolesGuard - –±–æ–ª–µ–µ —è–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**
**–§–∞–π–ª:** `server/src/auth/guards/roles.guard.ts` (—Å—Ç—Ä–æ–∫–∞ 13-17)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `!user || !user.role` –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª–µ–µ —è–≤–Ω–æ–π
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
const { user } = context.switchToHttp().getRequest();
if (!user || !user.role) {
  return false;
}
```

**–†–µ—à–µ–Ω–∏–µ:**
–£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
```typescript
const { user } = context.switchToHttp().getRequest();
if (!user) {
  return false;
}
if (!user.role) {
  return false;
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ –∫–æ–¥–∞)

---

### 45. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É name –∏ companyName –ø–æ—Å–ª–µ trim**
**–§–∞–π–ª:** `server/src/auth/auth.service.ts` (—Å—Ç—Ä–æ–∫–∞ 29, 35)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ—Å–ª–µ trim –¥–ª–∏–Ω–∞ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è
- DTO –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ trim, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å–ª–µ

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å–ª–µ trim (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, DTO —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç).

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)

---

### 46. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JWT –∞–ª–≥–æ—Ä–∏—Ç–º–∞**
**–§–∞–π–ª:** `server/src/auth/auth.module.ts` (—Å—Ç—Ä–æ–∫–∞ 24-29)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ —É–∫–∞–∑–∞–Ω –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è JWT (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é HS256, —á—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- –ú–æ–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**
–Ø–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º:
```typescript
return {
  secret: secret || 'secret',
  signOptions: {
    expiresIn: configService.get('JWT_EXPIRES_IN') || '7d',
    algorithm: 'HS256', // Explicitly set algorithm
  },
};
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - —è–≤–Ω–æ—Å—Ç—å)

---

## üìã –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| #   | –ë–∞–≥                                            | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç    | –§–∞–π–ª                           | –°—Ç–∞—Ç—É—Å          |
| --- | ---------------------------------------------- | ------------ | ------------------------------ | --------------- |
| 36  | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null company –≤ jwt.strategy | üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π | `jwt.strategy.ts:71`          | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| 37  | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null companyId –≤ payload | üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π | `jwt.strategy.ts:75`          | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| 38  | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ avatar URL                | üü° –°—Ä–µ–¥–Ω–∏–π   | `register.dto.ts:33`           | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| 39  | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã companyDomain | üü° –°—Ä–µ–¥–Ω–∏–π   | `register.dto.ts:26`          | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| 40  | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ user –≤ getProfile         | üü° –°—Ä–µ–¥–Ω–∏–π   | `auth.controller.ts:27`       | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| 41  | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å UUID –≤ payload.sub | üü° –°—Ä–µ–¥–Ω–∏–π   | `jwt.strategy.ts:51`          | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| 42  | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å UUID –≤ validateUser | üü° –°—Ä–µ–¥–Ω–∏–π   | `auth.service.ts:224`         | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| 43  | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å email –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ | üü° –°—Ä–µ–¥–Ω–∏–π   | `auth.service.ts:21`          | ‚ö†Ô∏è –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å |
| 44  | –£–ª—É—á—à–µ–Ω–∏–µ RolesGuard                           | üü¢ –ù–∏–∑–∫–∏–π    | `roles.guard.ts:13`            | ‚ö†Ô∏è –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å |
| 45  | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É –ø–æ—Å–ª–µ trim | üü¢ –ù–∏–∑–∫–∏–π    | `auth.service.ts:29`          | ‚ö†Ô∏è –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å |
| 46  | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JWT –∞–ª–≥–æ—Ä–∏—Ç–º–∞ | üü¢ –ù–∏–∑–∫–∏–π    | `auth.module.ts:24`            | ‚ö†Ô∏è –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω—ã–π):

1. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ null company –≤ jwt.strategy.ts**
2. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ null companyId –≤ payload**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–°—Ä–µ–¥–Ω–∏–π):

3. ‚ö†Ô∏è **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é avatar URL**
4. ‚ö†Ô∏è **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã companyDomain**
5. ‚ö†Ô∏è **–î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø–∏–∑–∞—Ü–∏—é user –≤ getProfile**
6. ‚ö†Ô∏è **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å UUID –≤ payload.sub**
7. ‚ö†Ô∏è **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å UUID –≤ validateUser**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ù–∏–∑–∫–∏–π):

8. üìù **–£–ª—É—á—à–∏—Ç—å RolesGuard**
9. üìù **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É –ø–æ—Å–ª–µ trim**
10. üìù **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JWT –∞–ª–≥–æ—Ä–∏—Ç–º–∞**

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏:** 2 ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
**–°—Ä–µ–¥–Ω–∏–µ –±–∞–≥–∏:** 6 ‚úÖ –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–ù–∏–∑–∫–∏–µ –±–∞–≥–∏/—É–ª—É—á—à–µ–Ω–∏—è:** 3 ‚ö†Ô∏è –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null company –≤ jwt.strategy.ts - **–ò–°–ü–†–ê–í–õ–ï–ù–û**
2. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null companyId –≤ payload - **–ò–°–ü–†–ê–í–õ–ï–ù–û**
3. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ avatar URL - **–ò–°–ü–†–ê–í–õ–ï–ù–û**
4. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã companyDomain - **–ò–°–ü–†–ê–í–õ–ï–ù–û**
5. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ UUID - **–ò–°–ü–†–ê–í–õ–ï–ù–û**

**–°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚úÖ –ë–∞–≥–∏ #36-37 (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ) - **–ò–°–ü–†–ê–í–õ–ï–ù–´**
- ‚úÖ –ë–∞–≥–∏ #38-42 (—Å—Ä–µ–¥–Ω–∏–µ) - **–ò–°–ü–†–ê–í–õ–ï–ù–´**
- ‚ö†Ô∏è –ë–∞–≥ #43 (—Å—Ä–µ–¥–Ω–∏–π) - –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å
- ‚ö†Ô∏è –ë–∞–≥–∏ #44-46 (–Ω–∏–∑–∫–∏–µ) - –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

**–û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null company –≤ jwt.strategy.ts
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null companyId –≤ payload (—Ç–µ–ø–µ—Ä—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è avatar URL (IsUrl —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏ http/https, MaxLength 2048)
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã companyDomain (MaxLength 255)
5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏—è user –≤ getProfile (User –≤–º–µ—Å—Ç–æ any)
6. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å UUID –≤ payload.sub
7. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å UUID –≤ validateUser

