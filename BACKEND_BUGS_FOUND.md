# üêõ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –±–∞–≥–∏ –≤ Backend

## üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏

### 1. **Race Condition –≤ `resume()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ activeEntryCheck –Ω–µ –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**

**–§–∞–π–ª:** `server/src/time-entries/time-entries.service.ts` (—Å—Ç—Ä–æ–∫–∞ 717-744)

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ `activeEntryCheck` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–æ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å race condition
- –ï—Å–ª–∏ –¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ resume –ø—Ä–∏–¥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –æ–±–∞ –º–æ–≥—É—Ç –ø—Ä–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –∏ —Å–æ–∑–¥–∞—Ç—å –¥–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö entry

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
const transactionResult = await this.prisma.$transaction(async (tx) => {
  const currentEntry = await tx.timeEntry.findUnique({
    where: { id },
    select: { status: true, userId: true },
  });

  if (!currentEntry || currentEntry.status !== "PAUSED") {
    throw new BadRequestException("Only paused entries can be resumed");
  }

  const activeEntryCheck = await tx.timeEntry.findFirst({
    where: {
      userId: currentEntry.userId,
      status: { in: ["RUNNING", "PAUSED"] },
      id: { not: id },
      user: { companyId },
    },
  });

  if (activeEntryCheck) {
    throw new BadRequestException("User already has an active time entry...");
  }

  // ‚ö†Ô∏è –ú–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å race condition
  const updatedEntry = await tx.timeEntry.update({
    where: { id },
    data: { startTime: new Date(), status: "RUNNING" },
    // ...
  });
});
```

**–°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç paused entry (ID: A)
2. –î–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ resume(A)
3. –û–±–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø—Ä–æ–≤–µ—Ä–∫—É `activeEntryCheck` (–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö entry)
4. –û–±–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç entry A –≤ —Å—Ç–∞—Ç—É—Å RUNNING
5. –ò–ª–∏ –æ–¥–∏–Ω —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π entry, –∞ –¥—Ä—É–≥–æ–π —Ä–µ–∑—é–º–∏—Ä—É–µ—Ç A

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SELECT FOR UPDATE` –∏–ª–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `(userId, status)` –≥–¥–µ status IN ('RUNNING', 'PAUSED'):

```typescript
// –í–∞—Ä–∏–∞–Ω—Ç 1: SELECT FOR UPDATE (PostgreSQL)
const activeEntryCheck = await tx.$queryRaw`
  SELECT * FROM time_entries 
  WHERE user_id = ${currentEntry.userId} 
    AND status IN ('RUNNING', 'PAUSED')
    AND id != ${id}
    AND EXISTS (SELECT 1 FROM users WHERE id = time_entries.user_id AND company_id = ${companyId})
  FOR UPDATE
`;

// –í–∞—Ä–∏–∞–Ω—Ç 2: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å (–ª—É—á—à–µ)
// –í schema.prisma –¥–æ–±–∞–≤–∏—Ç—å:
// @@unique([userId, status], where: { status: { in: [RUNNING, PAUSED] } })
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é –∞–∫—Ç–∏–≤–Ω—ã—Ö entry)

---

### 2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ companyId –≤ `resume()` –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `findUnique`**

**–§–∞–π–ª:** `server/src/time-entries/time-entries.service.ts` (—Å—Ç—Ä–æ–∫–∞ 718)

**–ü—Ä–æ–±–ª–µ–º–∞:**

- `findUnique` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `companyId` –Ω–∞–ø—Ä—è–º—É—é
- –•–æ—Ç—è `findOne` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç companyId, –Ω–æ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `findUnique` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
async resume(id: string, companyId: string, resumerId: string, resumerRole: UserRole) {
  const entry = await this.findOne(id, companyId); // ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç companyId

  // ...

  const transactionResult = await this.prisma.$transaction(async (tx) => {
    const currentEntry = await tx.timeEntry.findUnique({
      where: { id }, // ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ companyId!
      select: { status: true, userId: true },
    });
```

**–ê–Ω–∞–ª–∏–∑:**

- –•–æ—Ç—è `findOne` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç companyId –ø–µ—Ä–µ–¥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π, –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π entry –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω
- –í —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `findUnique` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ companyId

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `findFirst` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π companyId –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:

```typescript
const currentEntry = await tx.timeEntry.findFirst({
  where: {
    id,
    user: { companyId }, // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ companyId
  },
  select: { status: true, userId: true },
});
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —á—É–∂–∏–º –¥–∞–Ω–Ω—ã–º)

---

### 3. **–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤ `update()` - race condition –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ activeEntryCheck**

**–§–∞–π–ª:** `server/src/time-entries/time-entries.service.ts` (—Å—Ç—Ä–æ–∫–∞ 405-425)

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ RUNNING –ø—Ä–æ–≤–µ—Ä–∫–∞ `activeEntryCheck` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ù–æ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å race condition

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
const updated = await this.prisma.$transaction(async (tx) => {
  if (dto.status === "RUNNING" && entry.status !== "RUNNING") {
    const activeEntryCheck = await tx.timeEntry.findFirst({
      where: {
        userId: entry.userId,
        status: { in: ["RUNNING", "PAUSED"] },
        id: { not: id },
        user: { companyId },
      },
    });

    if (activeEntryCheck) {
      throw new BadRequestException("User already has an active time entry...");
    }
  }

  // ‚ö†Ô∏è –ú–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å race condition
  const currentEntry = await tx.timeEntry.findFirst({
    where: { id, user: { companyId } },
  });

  return tx.timeEntry.update({ where: { id }, data: updateData });
});
```

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SELECT FOR UPDATE` –∏–ª–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å (—Å–º. –±–∞–≥ #1)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π

---

## üü° –°—Ä–µ–¥–Ω–∏–µ –±–∞–≥–∏

### 4. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ `team-activity.service.ts`**

**–§–∞–π–ª:** `server/src/team-activity/team-activity.service.ts` (—Å—Ç—Ä–æ–∫–∞ 96-114)

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `where.id = effectiveUserId` –≤–º–µ—Å—Ç–æ `where: { id: effectiveUserId }`
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
const where: any = {
  companyId,
  status: "ACTIVE",
};

if (effectiveUserId) {
  const userCheck = await this.prisma.user.findFirst({
    where: {
      id: effectiveUserId,
      companyId,
    },
  });

  if (!userCheck) {
    throw new NotFoundException(
      `User with ID ${effectiveUserId} not found in your company`
    );
  }

  where.id = effectiveUserId; // ‚ö†Ô∏è –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è Prisma!
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**

- `where.id = effectiveUserId` - —ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è Prisma
- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å `where: { id: effectiveUserId }` –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π where

**–†–µ—à–µ–Ω–∏–µ:**

```typescript
const where: any = {
  companyId,
  status: "ACTIVE",
};

if (effectiveUserId) {
  const userCheck = await this.prisma.user.findFirst({
    where: {
      id: effectiveUserId,
      companyId,
    },
  });

  if (!userCheck) {
    throw new NotFoundException(
      `User with ID ${effectiveUserId} not found in your company`
    );
  }

  where.id = effectiveUserId; // ‚úÖ –≠—Ç–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è Prisma, –Ω–æ –ª—É—á—à–µ —è–≤–Ω–æ
  // –ò–ª–∏ –ª—É—á—à–µ:
  // where = { ...where, id: effectiveUserId };
}
```

**–ê–Ω–∞–ª–∏–∑:**

- –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ `where.id = effectiveUserId` —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ JavaScript, –Ω–æ —ç—Ç–æ –Ω–µ—è–≤–Ω–æ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ
- –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —è–≤–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π (–∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø–æ–Ω—è—Ç–µ–Ω)

---

### 5. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –≤ `update()` - entry –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏**

**–§–∞–π–ª:** `server/src/time-entries/time-entries.service.ts` (—Å—Ç—Ä–æ–∫–∞ 285, 427)

**–ü—Ä–æ–±–ª–µ–º–∞:**

- `findOne` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –í —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ entry —á–∏—Ç–∞–µ—Ç—Å—è —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ `findFirst`
- –ú–µ–∂–¥—É –¥–≤—É–º—è —á—Ç–µ–Ω–∏—è–º–∏ entry –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω –¥—Ä—É–≥–∏–º –∑–∞–ø—Ä–æ—Å–æ–º

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
async update(...) {
  const entry = await this.findOne(id, companyId); // ‚úÖ –ü–µ—Ä–≤–æ–µ —á—Ç–µ–Ω–∏–µ

  // ... –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ entry ...

  const updated = await this.prisma.$transaction(async (tx) => {
    // ... –ø—Ä–æ–≤–µ—Ä–∫–∏ ...

    const currentEntry = await tx.timeEntry.findFirst({ // ‚ö†Ô∏è –í—Ç–æ—Ä–æ–µ —á—Ç–µ–Ω–∏–µ
      where: { id, user: { companyId } },
    });

    if (!currentEntry) {
      throw new NotFoundException(`Time entry with ID ${id} not found`);
    }

    return tx.timeEntry.update({ where: { id }, data: updateData });
  });
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ú–µ–∂–¥—É `findOne` –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π entry –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ —Å—Ç–∞—Ä–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ entry

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∏–ª–∏ —á–∏—Ç–∞—Ç—å entry —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:

```typescript
const updated = await this.prisma.$transaction(async (tx) => {
  const entry = await tx.timeEntry.findFirst({
    where: { id, user: { companyId } },
    // ... include –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ ...
  });

  if (!entry) {
    throw new NotFoundException(`Time entry with ID ${id} not found`);
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ entry –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  // ...

  return tx.timeEntry.update({ where: { id }, data: updateData });
});
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö)

---

### 6. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ duration –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏**

**–§–∞–π–ª:** `server/src/time-entries/time-entries.service.ts` (—Å—Ç—Ä–æ–∫–∞ 350-360)

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –í `update()` –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ duration (2147483647)
- –ù–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ, –Ω–µ –ø—Ä–∏ –ø—Ä—è–º–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ `duration` –≤ DTO

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
if (updateData.duration !== undefined) {
  if (updateData.duration > 2147483647) {
    throw new BadRequestException("Duration exceeds maximum allowed value...");
  }
  if (updateData.duration < 0) {
    throw new BadRequestException("Duration cannot be negative");
  }
}
```

**–ê–Ω–∞–ª–∏–∑:**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –µ—Å—Ç—å, –Ω–æ –æ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `duration` —É–∫–∞–∑–∞–Ω –Ω–∞–ø—Ä—è–º—É—é –≤ DTO
- –ï—Å–ª–∏ duration —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑ startTime/endTime, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ
- –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (–ø—Ä–æ–≤–µ—Ä–∫–∞ –µ—Å—Ç—å, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å)

---

## üü¢ –ù–∏–∑–∫–∏–µ –±–∞–≥–∏ / –£–ª—É—á—à–µ–Ω–∏—è

### 7. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π email –≤ `users.service.ts`**

**–§–∞–π–ª:** `server/src/users/users.service.ts` (—Å—Ç—Ä–æ–∫–∞ 149-160)

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ email –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ç–∞–∫–∏–º email
- –ù–æ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ email

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
if (dto.email) {
  const existingUserWithEmail = await this.prisma.user.findFirst({
    where: {
      email: dto.email,
      companyId,
    },
  });

  if (existingUserWithEmail && existingUserWithEmail.id !== id) {
    throw new ConflictException(
      "User with this email already exists in your company"
    );
  }
}
```

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–∞ email (—á–µ—Ä–µ–∑ DTO –∏–ª–∏ –≤ —Å–µ—Ä–≤–∏—Å–µ):

```typescript
if (dto.email) {
  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ email
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(dto.email)) {
    throw new BadRequestException("Invalid email format");
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
  // ...
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ DTO)

---

### 8. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –≤ DTO**

**–§–∞–π–ª:** `server/src/screenshots/screenshots.service.ts` (—Å—Ç—Ä–æ–∫–∞ 77-80)

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Å–µ—Ä–≤–∏—Å–µ
- –ù–æ –ª—É—á—à–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤ DTO

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
const maxBase64Length = 50 * 1024 * 1024;
if (dto.imageData.length > maxBase64Length) {
  throw new BadRequestException("Image data exceeds maximum size (50MB)");
}
```

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ DTO —á–µ—Ä–µ–∑ class-validator:

```typescript
// upload-screenshot.dto.ts
@IsString()
@MaxLength(50 * 1024 * 1024, { message: 'Image data exceeds maximum size (50MB)' })
imageData: string;
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å)

---

### 9. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤ `screenshots.service.ts`**

**–§–∞–π–ª:** `server/src/screenshots/screenshots.service.ts` (—Å—Ç—Ä–æ–∫–∞ 139-160)

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ï—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ thumbnail –Ω–µ —É–¥–∞–ª–æ—Å—å, –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è
- –ù–æ –µ—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω–µ —É–¥–∞–ª–æ—Å—å, —Ñ–∞–π–ª –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
await fs.writeFile(filepath, processedImage);

// ... —Å–æ–∑–¥–∞–Ω–∏–µ thumbnail ...

let thumbnail: Buffer;
try {
  thumbnail = await sharp(imageBuffer)
    .resize(200, 150, { fit: 'cover' })
    .jpeg({ quality: 80 })
    .toBuffer();
} catch (error: any) {
  // ‚úÖ –£–¥–∞–ª—è–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏ –æ—à–∏–±–∫–µ thumbnail
  try {
    await fs.unlink(filepath);
  } catch (deleteError: any) {
    this.logger.error(...);
  }
  throw new BadRequestException('Failed to generate thumbnail');
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ï—Å–ª–∏ `fs.writeFile` –Ω–µ —É–¥–∞–ª—Å—è, —Ñ–∞–π–ª –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è (–Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã)
- –ù–æ –µ—Å–ª–∏ `sharp(imageBuffer).jpeg().toBuffer()` –Ω–µ —É–¥–∞–ª—Å—è –¥–æ `writeFile`, —Ñ–∞–π–ª –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è (–Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã)
- –ö–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (–∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

---

### 10. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `team-activity.service.ts`**

**–§–∞–π–ª:** `server/src/team-activity/team-activity.service.ts` (—Å—Ç—Ä–æ–∫–∞ 228-248)

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ `isFinite` –∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ù–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript
const duration = entry.duration ?? 0;
if (!isFinite(duration) || duration < 0 || duration > 2147483647) {
  this.logger.warn(
    { entryId: entry.id, duration, userId: entry.userId },
    "Invalid duration value, skipping entry"
  );
  return;
}

const hours = duration / 3600;
if (!isFinite(hours) || hours < 0) {
  this.logger.warn(
    { entryId: entry.id, hours },
    "Invalid hours calculation, skipping entry"
  );
  return;
}
```

**–ê–Ω–∞–ª–∏–∑:**

- –ü—Ä–æ–≤–µ—Ä–∫–∏ –µ—Å—Ç—å –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ù–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (CHECK constraint)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (–∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

---

## üìã –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| #   | –ë–∞–≥                                            | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç    | –§–∞–π–ª                           | –°—Ç–∞—Ç—É—Å            |
| --- | ---------------------------------------------- | ------------ | ------------------------------ | ----------------- |
| 1   | Race condition –≤ resume()                      | üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π | `time-entries.service.ts:717`  | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ     |
| 2   | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ companyId –≤ resume()       | üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π | `time-entries.service.ts:718`  | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ     |
| 3   | Race condition –≤ update()                      | üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–π | `time-entries.service.ts:405`  | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ     |
| 4   | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ team-activity        | üü° –°—Ä–µ–¥–Ω–∏–π   | `team-activity.service.ts:113` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ     |
| 5   | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –≤ update() | üü° –°—Ä–µ–¥–Ω–∏–π   | `time-entries.service.ts:285`  | ‚úÖ –£–ª—É—á—à–µ–Ω–æ       |
| 6   | –ü—Ä–æ–≤–µ—Ä–∫–∞ duration –≤ update()                   | üü¢ –ù–∏–∑–∫–∏–π    | `time-entries.service.ts:350`  | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç       |
| 7   | –í–∞–ª–∏–¥–∞—Ü–∏—è email –≤ update()                     | üü¢ –ù–∏–∑–∫–∏–π    | `users.service.ts:149`         | ‚úÖ –£–∂–µ –µ—Å—Ç—å –≤ DTO |
| 8   | –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –≤ DTO                  | üü¢ –ù–∏–∑–∫–∏–π    | `screenshots.service.ts:77`    | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ     |
| 9   | –û—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ                      | üü¢ –ù–∏–∑–∫–∏–π    | `screenshots.service.ts:139`   | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç       |
| 10  | –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π                | üü¢ –ù–∏–∑–∫–∏–π    | `team-activity.service.ts:228` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç       |

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

1. ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ companyId** - –≤–µ–∑–¥–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è companyId
2. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** - employees –Ω–µ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å —á—É–∂–∏–µ –∑–∞–ø–∏—Å–∏
3. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è employees** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
4. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
5. ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
6. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
7. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤** - –∑–∞—â–∏—Ç–∞ –æ—Ç path traversal –≤ screenshots
8. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
9. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏
10. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω—ã–π):

1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å race condition –≤ `resume()`**

   - –î–æ–±–∞–≤–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `(userId, status)` –≥–¥–µ status IN ('RUNNING', 'PAUSED')
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SELECT FOR UPDATE` –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

2. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É companyId –≤ `resume()` —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `findFirst` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π `user: { companyId }` –≤–º–µ—Å—Ç–æ `findUnique`

3. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å race condition –≤ `update()`**
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ resume(), –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∏–ª–∏ `SELECT FOR UPDATE`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–°—Ä–µ–¥–Ω–∏–π):

4. ‚ö†Ô∏è **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –≤ `team-activity.service.ts`**

   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `where.id = effectiveUserId` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —è–≤–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

5. ‚ö†Ô∏è **–£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ `update()`**
   - –ß–∏—Ç–∞—Ç—å entry —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ù–∏–∑–∫–∏–π):

6. üìù **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é email –≤ DTO**
7. üìù **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –≤ DTO**
8. üìù **–î–æ–±–∞–≤–∏—Ç—å CHECK constraint –≤ –ë–î –¥–ª—è duration**

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:

- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ companyId
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è employees
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è employees
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤ (path traversal)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:

- ‚ö†Ô∏è Race conditions –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö (resume, update)
- ‚ö†Ô∏è –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- ‚ö†Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ DTO (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å)

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏:** 3
**–°—Ä–µ–¥–Ω–∏–µ –±–∞–≥–∏:** 2
**–ù–∏–∑–∫–∏–µ –±–∞–≥–∏/—É–ª—É—á—à–µ–Ω–∏—è:** 5

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**

1. Race conditions –≤ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å time entries (resume, update)
2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ companyId –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
3. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**

- ‚úÖ –ë–∞–≥–∏ #1, #2, #3 (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ) - **–ò–°–ü–†–ê–í–õ–ï–ù–û**
- ‚úÖ –ë–∞–≥–∏ #4, #5 (—Å—Ä–µ–¥–Ω–∏–µ) - **–ò–°–ü–†–ê–í–õ–ï–ù–û/–£–õ–£–ß–®–ï–ù–û**
- ‚úÖ –ë–∞–≥–∏ #6-10 (–Ω–∏–∑–∫–∏–µ) - **–ü–†–û–í–ï–†–ï–ù–û/–ò–°–ü–†–ê–í–õ–ï–ù–û**

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** üü¢ –•–æ—Ä–æ—à–∞—è

- ‚úÖ –•–æ—Ä–æ—à–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ companyId
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ Race conditions –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ companyId –∏ —É–ª—É—á—à–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∞ - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –≤ DTO

**–°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**

- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –í—Å–µ —Å—Ä–µ–¥–Ω–∏–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã/—É–ª—É—á—à–µ–Ω—ã
- ‚úÖ –ù–∏–∑–∫–∏–µ –±–∞–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
